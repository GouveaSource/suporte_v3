generator client {
  provider = "prisma-client-js"
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "./diagrama_db.svg"
}


datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- ENUMS DE NEGÓCIO ---

enum Role {
  COMUM
  ADMIN
  ADMMaster
}

enum TipoReboque {
  LEVE
  PESADO
}

enum CategoriaCNH {
  A
  B
  C
  D
  E
  AB
  AC
  AD
  AE
}

enum Status {
  ATIVO
  INATIVO
}

// --- MODELOS DE AUTENTICAÇÃO E UTILIZADORES ---

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  nome          String
  password_hash String
  role          Role     @default(COMUM)
  status        Status   @default(ATIVO)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("users")
}

model RevokedToken {
  id        Int      @id @default(autoincrement())
  jti       String   @unique
  revokedAt DateTime @default(now())
  @@map("revoked_tokens")
}

// --- LÓGICA DO SISTEMA ---

model Setor {
  id          String   @id @default(uuid())
  nome        String
  telefone    String?
  ramal       String?
  responsavel String?
  status      Status   @default(ATIVO)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  @@map("setores")
}

model Acessorio {
  id     String @id @default(uuid())
  nome   String @unique
  status Status @default(ATIVO)

  reboques Reboque[]
  @@map("acessorios")
}

model Empresa {
  id     String @id @default(uuid())
  nome   String
  cnpj   String @unique
  status Status @default(ATIVO)

  reboques    Reboque[]
  guincheiros Guincheiro[]
  @@map("empresas")
}

model Reboque {
  id      String      @id @default(uuid())
  placa   String      @unique
  modelo  String
  tipo    TipoReboque
  status  Status      @default(ATIVO)

  empresaId String
  empresa   Empresa @relation(fields: [empresaId], references: [id])
  
  acessorios  Acessorio[]
  guincheiros Guincheiro[]
  @@map("reboques")
}

model Orgao {
  id     String @id @default(uuid())
  nome   String @unique
  status Status @default(ATIVO)

  patios      Patio[]
  guincheiros Guincheiro[]
  @@map("orgaos")
}

model Cidade {
  id     String @id @default(uuid())
  nome   String
  estado String
  status Status @default(ATIVO)

  patioId String
  patio   Patio  @relation(fields: [patioId], references: [id])
  
  guincheiros Guincheiro[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("cidades")
}

model Patio {
  id          String @id @default(uuid())
  nome        String @unique
  telefone    String?
  email       String?
  responsavel String?
  status      Status @default(ATIVO)
  
  // Endereço
  rua         String?
  numero      String?
  cep         String?
  bairro      String?
  referencia  String?
  linkMaps    String? 

  // Relações
  cidades     Cidade[]
  orgaos      Orgao[]
  guincheiros Guincheiro[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("patios")
}

model Guincheiro {
  id              String       @id @default(uuid())
  nome            String
  telefone        String
  cnh_categoria   CategoriaCNH
  status          Status       @default(ATIVO)

  empresaId String
  empresa   Empresa @relation(fields: [empresaId], references: [id])

  reboques Reboque[]
  patios   Patio[]
  cidades  Cidade[]
  orgaos   Orgao[]
  @@map("guincheiros")
}